#!/bin/bash
#description  :This script helps you to identify exploits associated to CVE using offline Nessus plugins
#author       :@MaKyOtOx
#date         :20180223
#version      :0.1

[ $# -eq 0 -o "${1:0:3}" != "CVE" ] && { echo "usage: $0 CVE-2017-10807"; exit -1; }

NESSUS_DIR="/Library/Nessus/run/lib/nessus/plugins"
NB_EXPLOITS=0

start_script=`date +%s`
echo "Searching in Nessus plugins..."

for plugin_filename in $(find $NESSUS_DIR -type f -exec grep -l $1 {} +); do

  if [ $(grep -c 'attribute:"exploit_available", value:"true"' $plugin_filename) -gt 0 ]; then
    echo $plugin_filename
    echo "CVSS base vector:  $(grep "script_set_cvss_base_vector" $plugin_filename | sed -e 's/^.*(\"\(.*\)\")\;/\1/')"
    echo "Exploit available: True"
    echo "Exploitability: $(grep "exploitability_ease" $plugin_filename | sed -e 's/^.*value\:\"\(.*\)\")\;/\1/')"
    plugin_id=$(cat $plugin_filename | grep script_id | sed -e 's/^.*(\(.*\))\;/\1/')
    echo -ne "More info at https://www.tenable.com/plugins/nessus/$plugin_id \n\n"

    NB_EXPLOITS+=1
  # else
  #   echo "No exploit available"
  fi
done


if [ $NB_EXPLOITS -eq 0 ]; then echo "No exploits found in Nessus pluggins infos for '$1'"; fi

end_script=`date +%s`
echo "Search ended. Script was executed in $((end_script-start_script)) seconds"
